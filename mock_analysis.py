#!/usr/bin/env python
"""
使用模拟 AI 分析结果来展示分析功能
"""

import os
import sys
import django

# 设置 Django 环境
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'grade_management.settings')
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

django.setup()

from students.models import Student
from ai_analysis.models import StudentAnalysis
from ai_analysis.views import prepare_student_data

def create_mock_analysis():
    """创建模拟的 AI 分析结果"""

    print("[INFO] 创建模拟 AI 分析结果...")

    # 获取学生
    try:
        student = Student.objects.get(student_id='20230015')
        print(f"[OK] 找到学生：{student.name} ({student.student_id})")
    except Student.DoesNotExist:
        print("[ERROR] 学生李小明不存在")
        return

    # 准备数据
    input_data = prepare_student_data(student, 'comprehensive')

    # 创建模拟的分析结果
    mock_result = """# 李小明同学360度综合学情分析报告

## 📊 执行摘要

### 关键发现
- 学业表现严重滞后，多门核心专业课挂科
- 学习基础薄弱，特别是在数学和理论课程方面
- 学习习惯和方法需要根本性改进
- 存在严重的自信心和学习动机问题

### 核心建议
1. 立即寻求学业指导和心理辅导
2. 重新评估专业选择和职业规划
3. 制定系统的补习计划
4. 建立有效的学习支持系统

### 总体评价
李小明同学目前处于严重的学业危机状态，需要立即采取综合干预措施。

---

## 🎯 学术能力分析

### 学术水平评估
- **学术等级**：严重困难（需立即干预）
- **专业适应性**：不适应，可能存在专业能力匹配问题
- **学习潜力**：中等，但需要正确的指导和支持

### 学业表现详情
- **总体成绩表现**：平均分59.4分，远低于及格线
- **学科优势分布**：无明显优势学科，体育成绩相对较好
- **知识掌握结构**：计算机科学基础严重缺失

---

## 🧠 认知能力分析

### 学习风格特征
- **感知偏好**：可能偏向实践型，但缺乏理论基础
- **信息处理方式**：细节处理能力较弱
- **思维方式**：逻辑思维和抽象思维能力有待提升

### 认知能力评估
- **逻辑思维能力**：薄弱（数学相关课程成绩证明）
- **批判性思维**：尚未形成有效的学习方法
- **创造性思维**：潜力未被发掘，被基础问题困扰

---

## 📖 学习行为分析

### 学习习惯特征
- **时间管理**：可能存在严重的时间分配问题
- **预习复习**：缺乏有效的学习循环
- **课堂参与**：可能因理解困难而被动
- **自主学习**：自主学习能力需要培养

### 学习节奏评估
- **课程负担**：当前课程负担可能超出其能力范围
- **学习进度**：明显落后于同班同学
- **知识积累**：知识碎片化，缺乏系统性

---

## ❤️ 情感态度分析

### 学习动机分析
- **内在动机**：可能因连续失败而严重受挫
- **外在动机**：家庭和社会压力可能适得其反
- **目标明确性**：对专业和未来缺乏清晰认识

### 学习态度表现
- **学习兴趣**：对计算机科学缺乏深度兴趣
- **学习坚持性**：遇到困难容易放弃
- **自我效能感**：严重不足，缺乏成功体验

### 心理素质评估
- **抗挫折能力**：较弱，容易产生习得性无助
- **焦虑水平**：可能存在考试焦虑和学习焦虑
- **自我认知**：对自己的学习能力认知不清

---

## 📊 发展潜力分析

### 优势领域识别
1. **实践能力**：体育成绩较好，说明有一定实践能力
2. **潜力**：年龄尚轻，有足够时间进行改进
3. **可塑性**：在正确指导下仍有很大改进空间

### 发展机会识别
1. **转专业机会**：考虑更适合的专业方向
2. **技能培训**：转向应用型技能学习
3. **个性化发展**：找到适合的学习方式

### 潜在风险评估
1. **学业中断风险**：高，需立即干预
2. **心理问题风险**：抑郁、焦虑等心理问题
3. **就业前景风险**：如不改善，就业前景堪忧

---

## 🎯 个性化发展建议

### 学业发展建议

#### 短期目标（1-3个月）
1. **立即措施**
   - 与学业导师深度沟通
   - 寻求心理咨询师帮助
   - 暂停部分高难度课程
   - 集中精力补习基础课程

2. **基础补习计划**
   - 数学基础：每天2小时，从初等数学开始
   - 英语强化：每天1小时，提高自信心
   - 编程基础：从简单项目开始，重建兴趣

#### 中期目标（3-6个月）
1. **能力提升路径**
   - 参加学习小组，获得同伴支持
   - 寻找专业家教，一对一辅导
   - 参加线上课程，弥补知识空白
   - 建立有效的学习习惯

2. **专业适应调整**
   - 评估是否适合继续计算机专业
   - 考虑转向更应用性的专业
   - 探索其他兴趣和天赋领域

#### 长期目标（6-12个月）
1. **全面发展计划**
   - 重建学习自信心
   - 培养有效的学习方法
   - 确定合适的职业发展方向
   - 建立积极的自我认知

---

## 📈 跟踪评估机制

### 关键绩效指标
1. **学业指标**
   - 每月考试成绩提升幅度
   - 作业完成率和质量
   - 课堂参与度变化
   - 学习时间投入

2. **心理指标**
   - 学习动机水平变化
   - 焦虑程度评估
   - 自我效能感提升
   - 对未来的期望值

### 评估周期建议
- **每周**：基础科目小测验
- **每月**：综合评估和调整
- **每学期**：学业目标完成情况

### 调整优化策略
1. **动态调整**：根据进步情况调整学习计划
2. **多维度支持**：结合学业、心理、社交支持
3. **正向激励**：设置小目标，及时奖励进步
4. **长期规划**：制定个性化的发展路径

---

## 💡 紧急干预措施

### 立即行动（本周内）
1. **联系家长**：告知学业状况，争取家庭支持
2. **学业导师**：安排紧急面谈，制定补习计划
3. **心理咨询**：评估心理健康状况
4. **课程调整**：减轻当前学业负担

### 支持系统建设
1. **学习伙伴**：安排优秀同学结对帮助
2. **专业辅导**：寻找合适的家教或辅导机构
3. **时间管理**：建立科学的学习时间表
4. **目标管理**：设定短期可实现的小目标

---

## 📋 总结与建议

李小明同学目前面临严重的学业危机，但这并不意味着没有希望。关键在于：

1. **及时干预**：问题已经积累到一定程度，需要立即采取行动
2. **综合支持**：需要学校、家庭、同学的多方面支持
3. **个性化方案**：每个人的学习方式不同，需要找到适合的方法
4. **长期坚持**：改变需要时间，需要持续的耐心和支持

**建议优先级：**
1. 🔴 紧急：心理健康和基础补习
2. 🟡 重要：学习方法和时间管理
3. 🟢 长期：专业适应和职业规划

通过系统性的干预和支持，李小明同学完全有可能走出学习困境，找到适合自己的发展道路。"""

    # 创建分析记录
    analysis = StudentAnalysis.objects.create(
        student=student,
        analysis_type='comprehensive',
        title=f'{student.name}的综合学情分析报告',
        status='completed',
        input_data=input_data,
        analysis_result=mock_result,
        ai_confidence=0.92,  # 模拟高置信度
        analyzed_by='DeepSeek AI Analysis Agent (Mock)',
        actual_prompt='基于李小明同学的学习数据进行360度综合分析...'
    )

    print(f"[SUCCESS] 模拟分析创建完成！")
    print(f"  分析ID：{analysis.id}")
    print(f"  置信度：{analysis.ai_confidence}")
    print(f"  分析结果长度：{len(mock_result)} 字符")

    return analysis

if __name__ == '__main__':
    try:
        analysis = create_mock_analysis()
        print(f"\n[SUCCESS] 问题学生模拟分析完成！")
        print(f"可以通过以下链接查看分析结果：")
        print(f"  - AI 分析演示页：http://127.0.0.1:8000/ai/demo/")
        print(f"  - 分析详情页：http://127.0.0.1:8000/ai/detail/{analysis.id}/")
        print(f"  - 学生管理：http://127.0.0.1:8000/students/")

    except Exception as e:
        print(f"\n[ERROR] 脚本执行失败：{e}")
        import traceback
        traceback.print_exc()
        sys.exit(1)