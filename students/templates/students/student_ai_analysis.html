{% extends 'students/base.html' %}

{% block title %}Student AI Learning Analysis - WiseMentor{% endblock %}

{% block page_title %}
<div class="d-flex align-items-center">
    <i class="bi bi-person-lines-fill text-primary me-3"></i>
    Student AI Learning Analysis
</div>
{% endblock %}

{% block content %}
<!-- 学生基本信息卡片 -->
<div class="card mb-4 bg-gradient-to-r from-primary to-blue-600 text-white">
    <div class="card-body">
        <div class="row align-items-center">
            <div class="col-md-2">
                <div class="w-24 h-24 bg-white bg-opacity-20 rounded-full mx-auto flex items-center justify-center">
                    <i class="bi bi-person fs-5"></i>
                </div>
            </div>
            <div class="col-md-6">
                <h3 class="font-bold mb-1">Zhang Wei</h3>
                <div class="row">
                    <div class="col-sm-6 mb-1">
                        <small class="text-white-700">Student ID:</small> <span>20230014</span>
                    </div>
                    <div class="col-sm-6 mb-1">
                        <small class="text-white-700">Class:</small> <span>CS2023-1</span>
                    </div>
                    <div class="col-sm-6 mb-1">
                        <small class="text-white-700">Major:</small> <span>Computer Science</span>
                    </div>
                    <div class="col-sm-6 mb-1">
                        <small class="text-white-700">GPA:</small> <span class="badge bg-white text-primary">2.7</span>
                    </div>
                </div>
            </div>
            <div class="col-md-4 text-end">
                <button class="btn btn-warning text-white mb-2" id="ai-agent-analysis-btn" onclick="startAIAgentAnalysis('{{ student.student_id }}')">
                    <i class="bi bi-cpu me-2"></i>AI Agent Analysis
                </button>
                <button class="btn btn-white text-primary mb-2">Generate PDF Report</button>
                <button class="btn btn-white btn-outline-light">Schedule Meeting</button>
            </div>
        </div>
    </div>
</div>

<!-- 主要内容区域 -->
<div class="row">
    <!-- 左侧面板 -->
    <div class="col-md-8">
        <!-- 学习表现趋势 -->
        <div class="card mb-4">
            <div class="card-header bg-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-trend-up text-primary me-2"></i>
                        Learning Performance Trend
                    </h5>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-primary active">Semester</button>
                        <button class="btn btn-outline-primary">Year</button>
                        <button class="btn btn-outline-primary">Overall</button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <canvas id="performance-trend-chart" height="300"></canvas>
            </div>
        </div>
        
        <!-- 课程表现详情 -->
        <div class="card mb-4">
            <div class="card-header bg-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-book text-secondary me-2"></i>
                        Course Performance Details
                    </h5>
                    <div class="input-group input-group-sm" style="width: 200px;">
                        <input type="text" class="form-control" placeholder="Search course...">
                        <button class="btn btn-primary"><i class="bi bi-search"></i></button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Course</th>
                                <th>Exam Score</th>
                                <th>Assignment Avg</th>
                                <th>Participation</th>
                                <th>Final Grade</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="table-danger">
                                <td>
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-calculator text-danger me-2"></i>
                                        <div>
                                            <div class="font-bold">MATH201 - Advanced Mathematics</div>
                                            <small class="text-muted">Prof. Liu</small>
                                        </div>
                                    </div>
                                </td>
                                <td>42</td>
                                <td>35</td>
                                <td>70%</td>
                                <td>45</td>
                                <td><span class="badge bg-danger">F</span></td>
                            </tr>
                            <tr class="table-warning">
                                <td>
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-laptop text-warning me-2"></i>
                                        <div>
                                            <div class="font-bold">CS101 - Introduction to CS</div>
                                            <small class="text-muted">Prof. Wang</small>
                                        </div>
                                    </div>
                                </td>
                                <td>65</td>
                                <td>70</td>
                                <td>60%</td>
                                <td>68</td>
                                <td><span class="badge bg-warning">D</span></td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-file-code text-info me-2"></i>
                                        <div>
                                            <div class="font-bold">CS201 - Programming Fundamentals</div>
                                            <small class="text-muted">Prof. Zhang</small>
                                        </div>
                                    </div>
                                </td>
                                <td>78</td>
                                <td>82</td>
                                <td>85%</td>
                                <td>80</td>
                                <td><span class="badge bg-info">B</span></td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-language text-success me-2"></i>
                                        <div>
                                            <div class="font-bold">ENG102 - English Composition</div>
                                            <small class="text-muted">Prof. Smith</small>
                                        </div>
                                    </div>
                                </td>
                                <td>85</td>
                                <td>90</td>
                                <td>95%</td>
                                <td>88</td>
                                <td><span class="badge bg-success">A</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- 学习行为分析 -->
        <div class="card mb-4">
            <div class="card-header bg-white">
                <h5 class="mb-0">
                    <i class="bi bi-activity text-purple-600 me-2"></i>
                    Learning Behavior Analysis
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-4">
                            <h6>Study Time Distribution</h6>
                            <canvas id="study-time-chart" height="200"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-4">
                            <h6>Assignment Submission Patterns</h6>
                            <canvas id="submission-pattern-chart" height="200"></canvas>
                        </div>
                    </div>
                </div>
                <div class="bg-info bg-opacity-10 p-4 rounded-lg">
                    <h6 class="text-info mb-2"><i class="bi bi-info-circle me-2"></i>Behavioral Insights</h6>
                    <ul class="list-disc pl-5 text-sm">
                        <li>Study sessions are inconsistent, with most activity concentrated before deadlines</li>
                        <li>Low participation in online discussions and collaborative activities</li>
                        <li>Mathematics assignments show rushed completion with high error rates</li>
                        <li>English and Programming assignments demonstrate more thorough work</li>
                        <li>Peak study times occur between 8-10 PM on weekdays</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 右侧面板 -->
    <div class="col-md-4">
        <!-- 学习风险评估 -->
        <div class="card mb-4 border-danger">
            <div class="card-header bg-danger bg-opacity-10">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 text-danger">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        Learning Risk Assessment
                    </h5>
                    <span class="badge bg-danger">High Risk</span>
                </div>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span class="text-sm">Overall Risk Score</span>
                        <span class="text-sm font-bold">78/100</span>
                    </div>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-danger" style="width: 78%;"></div>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <div>
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-sm">Academic Performance</span>
                            <span class="text-sm font-bold">High Risk</span>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-danger" style="width: 85%;"></div>
                        </div>
                    </div>
                    <div>
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-sm">Engagement Level</span>
                            <span class="text-sm font-bold">Medium Risk</span>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-warning" style="width: 60%;"></div>
                        </div>
                    </div>
                    <div>
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-sm">Assignment Completion</span>
                            <span class="text-sm font-bold">High Risk</span>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-danger" style="width: 75%;"></div>
                        </div>
                    </div>
                    <div>
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-sm">Learning Trend</span>
                            <span class="text-sm font-bold">Critical Risk</span>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-danger" style="width: 90%;"></div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4 p-3 bg-danger bg-opacity-10 rounded-lg">
                    <h6 class="text-danger text-sm font-bold mb-2">Critical Alert</h6>
                    <p class="text-sm">Student is showing a significant downward trend in Mathematics courses. Immediate intervention recommended.</p>
                </div>
            </div>
        </div>
        
        <!-- 知识掌握情况 -->
        <div class="card mb-4">
            <div class="card-header bg-white">
                <h5 class="mb-0">
                    <i class="bi bi-pie-chart text-green-600 me-2"></i>
                    Knowledge Mastery
                </h5>
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-6">
                        <canvas id="knowledge-mastery-chart" height="150"></canvas>
                    </div>
                    <div class="col-6">
                        <div class="space-y-2">
                            <div class="d-flex align-items-center">
                                <div class="w-3 h-3 bg-success rounded-full me-2"></div>
                                <span class="text-sm">Mastered (30%)</span>
                            </div>
                            <div class="d-flex align-items-center">
                                <div class="w-3 h-3 bg-info rounded-full me-2"></div>
                                <span class="text-sm">Proficient (25%)</span>
                            </div>
                            <div class="d-flex align-items-center">
                                <div class="w-3 h-3 bg-warning rounded-full me-2"></div>
                                <span class="text-sm">Developing (15%)</span>
                            </div>
                            <div class="d-flex align-items-center">
                                <div class="w-3 h-3 bg-danger rounded-full me-2"></div>
                                <span class="text-sm">Needs Help (30%)</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-2">
                    <h6 class="text-sm font-bold">Weakest Areas</h6>
                    <div class="p-2 border rounded-lg bg-danger bg-opacity-10">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-xs">Functions & Calculus</span>
                            <span class="text-xs font-bold text-danger">25% Mastery</span>
                        </div>
                        <div class="progress" style="height: 4px;">
                            <div class="progress-bar bg-danger" style="width: 25%;"></div>
                        </div>
                    </div>
                    <div class="p-2 border rounded-lg bg-danger bg-opacity-10">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-xs">Problem-solving Approaches</span>
                            <span class="text-xs font-bold text-danger">30% Mastery</span>
                        </div>
                        <div class="progress" style="height: 4px;">
                            <div class="progress-bar bg-danger" style="width: 30%;"></div>
                        </div>
                    </div>
                    <div class="p-2 border rounded-lg bg-warning bg-opacity-10">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-xs">Algorithm Design</span>
                            <span class="text-xs font-bold text-warning">55% Mastery</span>
                        </div>
                        <div class="progress" style="height: 4px;">
                            <div class="progress-bar bg-warning" style="width: 55%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AI个性化建议 -->
        <div class="card mb-4">
            <div class="card-header bg-white">
                <h5 class="mb-0">
                    <i class="bi bi-lightbulb text-yellow-500 me-2"></i>
                    AI Personalized Recommendations
                </h5>
            </div>
            <div class="card-body">
                <div class="space-y-3">
                    <div class="p-3 bg-light rounded-lg">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-sm font-bold">Priority 1</span>
                            <span class="text-xs badge bg-danger">Critical</span>
                        </div>
                        <p class="text-sm mb-2">Schedule weekly one-on-one tutoring sessions with Math professor focused on functions and calculus concepts.</p>
                        <div class="d-flex justify-content-between text-xs text-muted">
                            <span>Potential Impact: High</span>
                            <span>Est. Time: 1 hour/week</span>
                        </div>
                    </div>
                    
                    <div class="p-3 bg-light rounded-lg">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-sm font-bold">Priority 2</span>
                            <span class="text-xs badge bg-warning">High</span>
                        </div>
                        <p class="text-sm mb-2">Assign supplementary practice materials from the "Functions Mastery" resource library with step-by-step solutions.</p>
                        <div class="d-flex justify-content-between text-xs text-muted">
                            <span>Potential Impact: Medium</span>
                            <span>Est. Time: 2-3 hours/week</span>
                        </div>
                    </div>
                    
                    <div class="p-3 bg-light rounded-lg">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="text-sm font-bold">Priority 3</span>
                            <span class="text-xs badge bg-info">Medium</span>
                        </div>
                        <p class="text-sm mb-2">Implement a structured study plan with daily micro-learning sessions (20-30 minutes) on difficult topics.</p>
                        <div class="d-flex justify-content-between text-xs text-muted">
                            <span>Potential Impact: Medium</span>
                            <span>Est. Time: 30 min/day</span>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-primary btn-sm w-100 mt-3">
                    <i class="bi bi-check-circle me-1"></i> Generate Intervention Plan
                </button>
            </div>
        </div>
        
        <!-- 推荐学习资源 -->
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0">
                    <i class="bi bi-book-fill text-blue-600 me-2"></i>
                    Recommended Resources
                </h5>
            </div>
            <div class="card-body">
                <div class="space-y-3">
                    <div class="border rounded-lg p-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="badge bg-primary">Math</span>
                            <span class="text-xs text-muted">Video</span>
                        </div>
                        <h6 class="text-sm font-bold mb-1">Functions Fundamentals Series</h6>
                        <p class="text-xs text-muted mb-2">Step-by-step video tutorials covering basic to advanced function concepts.</p>
                        <button class="btn btn-xs btn-outline-primary w-100" onclick="window.open('https://www.youtube.com/user/khanacademy', '_blank')">Assign Resource</button>
                    </div>
                    
                    <div class="border rounded-lg p-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="badge bg-primary">Math</span>
                            <span class="text-xs text-muted">Practice</span>
                        </div>
                        <h6 class="text-sm font-bold mb-1">Calculus Problem Solver Workbook</h6>
                        <p class="text-xs text-muted mb-2">Interactive exercises with instant feedback and solution hints.</p>
                        <button class="btn btn-xs btn-outline-primary w-100" onclick="window.open('https://www.youtube.com/user/patrickJMT', '_blank')">Assign Resource</button>
                    </div>
                    
                    <div class="border rounded-lg p-3">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="badge bg-info">CS</span>
                            <span class="text-xs text-muted">Interactive</span>
                        </div>
                        <h6 class="text-sm font-bold mb-1">Visual Algorithm Designer</h6>
                        <p class="text-xs text-muted mb-2">Visual tool to help understand algorithm design principles.</p>
                        <button class="btn btn-xs btn-outline-primary w-100" onclick="window.open('https://www.youtube.com/c/Freecodecamp', '_blank')">Assign Resource</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// 学习表现趋势图表
const performanceCtx = document.getElementById('performance-trend-chart').getContext('2d');
const performanceChart = new Chart(performanceCtx, {
    type: 'line',
    data: {
        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6', 'Week 7', 'Week 8', 'Week 9', 'Week 10', 'Week 11', 'Week 12'],
        datasets: [
            {
                label: 'Mathematics',
                data: [78, 75, 70, 65, 60, 55, 50, 45, 40, 35, 30, 25],
                borderColor: 'rgb(255, 99, 132)',
                backgroundColor: 'rgba(255, 99, 132, 0.1)',
                tension: 0.4,
                fill: true
            },
            {
                label: 'Computer Science',
                data: [70, 72, 75, 78, 80, 78, 80, 82, 85, 83, 85, 88],
                borderColor: 'rgb(54, 162, 235)',
                backgroundColor: 'rgba(54, 162, 235, 0.1)',
                tension: 0.4,
                fill: true
            },
            {
                label: 'English',
                data: [82, 85, 83, 85, 88, 90, 88, 92, 90, 95, 93, 96],
                borderColor: 'rgb(75, 192, 192)',
                backgroundColor: 'rgba(75, 192, 192, 0.1)',
                tension: 0.4,
                fill: true
            }
        ]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'top',
            },
            tooltip: {
                mode: 'index',
                intersect: false,
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                max: 100,
                title: {
                    display: true,
                    text: 'Average Score'
                }
            }
        }
    }
});

// 学习时间分布图表
const studyTimeCtx = document.getElementById('study-time-chart').getContext('2d');
const studyTimeChart = new Chart(studyTimeCtx, {
    type: 'doughnut',
    data: {
        labels: ['Weekdays', 'Weekends', 'Late Night'],
        datasets: [{
            data: [60, 30, 10],
            backgroundColor: [
                'rgba(54, 162, 235, 0.7)',
                'rgba(75, 192, 192, 0.7)',
                'rgba(255, 159, 64, 0.7)'
            ],
            borderColor: [
                'rgb(54, 162, 235)',
                'rgb(75, 192, 192)',
                'rgb(255, 159, 64)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom',
            }
        }
    }
});

// 作业提交模式图表
const submissionCtx = document.getElementById('submission-pattern-chart').getContext('2d');
const submissionChart = new Chart(submissionCtx, {
    type: 'bar',
    data: {
        labels: ['On Time', '1 Day Late', '2-3 Days Late', '>3 Days Late'],
        datasets: [{
            label: 'Submission Count',
            data: [4, 6, 8, 12],
            backgroundColor: [
                'rgba(75, 192, 192, 0.7)',
                'rgba(255, 205, 86, 0.7)',
                'rgba(255, 159, 64, 0.7)',
                'rgba(255, 99, 132, 0.7)'
            ],
            borderColor: [
                'rgb(75, 192, 192)',
                'rgb(255, 205, 86)',
                'rgb(255, 159, 64)',
                'rgb(255, 99, 132)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true,
                title: {
                    display: true,
                    text: 'Number of Assignments'
                }
            }
        },
        plugins: {
            legend: {
                display: false
            }
        }
    }
});

// 知识掌握情况图表
const knowledgeCtx = document.getElementById('knowledge-mastery-chart').getContext('2d');
const knowledgeChart = new Chart(knowledgeCtx, {
    type: 'doughnut',
    data: {
        labels: ['Mastered', 'Proficient', 'Developing', 'Needs Help'],
        datasets: [{
            data: [30, 25, 15, 30],
            backgroundColor: [
                'rgba(75, 192, 192, 0.7)',
                'rgba(54, 162, 235, 0.7)',
                'rgba(255, 205, 86, 0.7)',
                'rgba(255, 99, 132, 0.7)'
            ],
            borderColor: [
                'rgb(75, 192, 192)',
                'rgb(54, 162, 235)',
                'rgb(255, 205, 86)',
                'rgb(255, 99, 132)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                display: false
            }
        },
        cutout: '70%'
    }
});

// AI Agent Analysis Function
function startAIAgentAnalysis(studentId) {
    const btn = document.getElementById('ai-agent-analysis-btn');
    const originalText = btn.innerHTML;

    // Disable button and show loading state
    btn.disabled = true;
    btn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>AI Analyzing...';

    // Make AJAX request to start AI analysis
    fetch(`/ai/agent/analyze/${studentId}/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Show success message
            showNotification('AI analysis started successfully! This may take a few moments.', 'success');

            // Start polling for analysis completion
            pollAnalysisStatus(data.analysis_id, studentId);
        } else {
            showNotification('Error: ' + (data.error || 'Failed to start analysis'), 'error');
            btn.disabled = false;
            btn.innerHTML = originalText;
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showNotification('Network error occurred. Please try again.', 'error');
        btn.disabled = false;
        btn.innerHTML = originalText;
    });
}

// Poll for analysis completion
function pollAnalysisStatus(analysisId, studentId) {
    const maxAttempts = 60; // Maximum 5 minutes (60 * 5 seconds)
    let attempts = 0;

    const pollInterval = setInterval(() => {
        attempts++;

        fetch(`/ai/agent/status/${analysisId}/`)
        .then(response => response.json())
        .then(data => {
            if (data.status === 'completed') {
                clearInterval(pollInterval);
                showNotification('AI analysis completed! Refreshing results...', 'success');
                // Refresh the page to show updated analysis
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            } else if (data.status === 'failed') {
                clearInterval(pollInterval);
                showNotification('Analysis failed: ' + (data.error || 'Unknown error'), 'error');
                const btn = document.getElementById('ai-agent-analysis-btn');
                btn.disabled = false;
                btn.innerHTML = '<i class="bi bi-cpu me-2"></i>AI Agent Analysis';
            } else if (attempts >= maxAttempts) {
                clearInterval(pollInterval);
                showNotification('Analysis timed out. Please try again later.', 'warning');
                const btn = document.getElementById('ai-agent-analysis-btn');
                btn.disabled = false;
                btn.innerHTML = '<i class="bi bi-cpu me-2"></i>AI Agent Analysis';
            }
        })
        .catch(error => {
            console.error('Polling error:', error);
            if (attempts >= maxAttempts) {
                clearInterval(pollInterval);
                showNotification('Failed to check analysis status', 'error');
                const btn = document.getElementById('ai-agent-analysis-btn');
                btn.disabled = false;
                btn.innerHTML = '<i class="bi bi-cpu me-2"></i>AI Agent Analysis';
            }
        });
    }, 5000); // Poll every 5 seconds
}

// Helper function to get CSRF token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Notification system
function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
    notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;

    document.body.appendChild(notification);

    // Auto remove after 5 seconds
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 5000);
}
</script>
{% endblock %}