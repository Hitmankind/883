# æœºæ¢°è‡‚äººè„¸è¿½è¸ªç³»ç»Ÿé›†æˆæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®å·²æˆåŠŸä¸ºTeaching Mechanical Arm Moduleæ·»åŠ äº†äººè„¸è¿½è¸ªåŠŸèƒ½ã€‚ç³»ç»ŸåŒ…å«å®Œæ•´çš„ç”¨æˆ·ç•Œé¢ã€äººè„¸æ£€æµ‹ã€æœºæ¢°è‡‚æ§åˆ¶å’Œå¯è§†åŒ–åŠŸèƒ½ã€‚

## âœ… å·²å®ç°åŠŸèƒ½

### ğŸ¥ è§†é¢‘å’Œäººè„¸æ£€æµ‹
- **å®æ—¶è§†é¢‘æµ**ï¼šä½¿ç”¨WebRTCè®¿é—®æ‘„åƒå¤´
- **äººè„¸æ£€æµ‹**ï¼šåŸºäºface-api.jsçš„å®æ—¶äººè„¸è¯†åˆ«
- **å¯è§†åŒ–è¿½è¸ª**ï¼šç»¿è‰²æ–¹æ¡†å’Œåå­—å‡†çº¿æ ‡è®°æ£€æµ‹åˆ°çš„äººè„¸
- **åæ ‡æ˜¾ç¤º**ï¼šå®æ—¶æ˜¾ç¤ºäººè„¸åœ¨è§†é¢‘ä¸­çš„åæ ‡ä½ç½®

### ğŸ¤– æœºæ¢°è‡‚æ§åˆ¶
- **è¿æ¥ç®¡ç†**ï¼šæ¨¡æ‹Ÿæœºæ¢°è‡‚è¿æ¥çŠ¶æ€
- **å¤šç§æ§åˆ¶æ¨¡å¼**ï¼š
  - äººè„¸è¿½è¸ªæ¨¡å¼ï¼ˆè‡ªåŠ¨è¿½è¸ªæ£€æµ‹åˆ°çš„äººè„¸ï¼‰
  - æ‰‹åŠ¨æ§åˆ¶æ¨¡å¼ï¼ˆæ–¹å‘é”®æ§åˆ¶ï¼‰
- **æœºæ¢°è‡‚æ ¡å‡†**ï¼šä¸€é”®æ ¡å‡†æœºæ¢°è‡‚åˆ°åˆå§‹ä½ç½®
- **å¤¹çˆªæ§åˆ¶**ï¼šå¼€åˆæœºæ¢°å¤¹çˆª

### ğŸ›ï¸ ç”¨æˆ·ç•Œé¢
- **å“åº”å¼è®¾è®¡**ï¼šé€‚é…ä¸åŒå±å¹•å°ºå¯¸
- **å®æ—¶çŠ¶æ€æ˜¾ç¤º**ï¼šè¿½è¸ªçŠ¶æ€ã€ä½ç½®åæ ‡ã€è¿æ¥çŠ¶æ€
- **æ§åˆ¶é¢æ¿**ï¼šç›´è§‚çš„æŒ‰é’®å’Œæ»‘å—æ§åˆ¶
- **å¯è§†åŒ–åŠ¨ç”»**ï¼šæœºæ¢°è‡‚ä½ç½®çš„å®æ—¶å¯è§†åŒ–
- **è®¾ç½®é€‰é¡¹**ï¼šè¿½è¸ªé€Ÿåº¦ã€çµæ•åº¦ç­‰å¯è°ƒå‚æ•°

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### 1. è®¿é—®ç³»ç»Ÿ
- æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:8000/robot-arm/`
- éœ€è¦æ•™å¸ˆæƒé™ç™»å½•

### 2. åŸºæœ¬æ“ä½œæµç¨‹
1. **å¯åŠ¨æ‘„åƒå¤´**ï¼šç‚¹å‡»"Start Camera"æŒ‰é’®
2. **å¼€å§‹äººè„¸æ£€æµ‹**ï¼šç‚¹å‡»"Start Face Tracking"æŒ‰é’®
3. **è¿æ¥æœºæ¢°è‡‚**ï¼šç‚¹å‡»"Connect Arm"æŒ‰é’®
4. **é€‰æ‹©æ§åˆ¶æ¨¡å¼**ï¼š
   - Track Modeï¼šæœºæ¢°è‡‚è‡ªåŠ¨è¿½è¸ªäººè„¸
   - Manual Modeï¼šä½¿ç”¨æ–¹å‘é”®æ‰‹åŠ¨æ§åˆ¶
5. **è°ƒæ•´å‚æ•°**ï¼šæ ¹æ®éœ€è¦è°ƒæ•´è¿½è¸ªé€Ÿåº¦å’Œçµæ•åº¦

### 3. åŠŸèƒ½ç‰¹æ€§
- **å®æ—¶è¿½è¸ª**ï¼šç³»ç»Ÿä¼šå®æ—¶æ£€æµ‹å¹¶è¿½è¸ªäººè„¸ä½ç½®
- **åæ ‡æ˜ å°„**ï¼šå°†äººè„¸ä½ç½®è½¬æ¢ä¸ºæœºæ¢°è‡‚åæ ‡
- **å¹³æ»‘è¿åŠ¨**ï¼šæœºæ¢°è‡‚è¿åŠ¨å¹³æ»‘è‡ªç„¶
- **çŠ¶æ€ç›‘æ§**ï¼šå®æ—¶æ˜¾ç¤ºç³»ç»ŸçŠ¶æ€å’Œä½ç½®ä¿¡æ¯

## ğŸ”§ æŠ€æœ¯æ¶æ„

### å‰ç«¯æŠ€æœ¯æ ˆ
- **HTML5/CSS3/JavaScript**ï¼šåŸºç¡€WebæŠ€æœ¯
- **Bootstrap 5**ï¼šå“åº”å¼UIæ¡†æ¶
- **face-api.js**ï¼šäººè„¸æ£€æµ‹åº“
- **WebRTC**ï¼šæ‘„åƒå¤´è®¿é—®API

### åç«¯æ¶æ„
- **Django 5.1.6**ï¼šWebæ¡†æ¶
- **RESTful API**ï¼šæœºæ¢°è‡‚æ§åˆ¶æ¥å£
- **CSRFä¿æŠ¤**ï¼šå®‰å…¨çš„APIé€šä¿¡

### APIæ¥å£

#### æœºæ¢°è‡‚æ§åˆ¶
```
POST /api/arm-control/
Content-Type: application/json

{
  "command": "connect|move|calibrate|gripper|track_face",
  "position": {
    "x": 0,
    "y": 0,
    "z": 0
  }
}
```

#### æœºæ¢°è‡‚çŠ¶æ€
```
GET /api/arm-status/

Response:
{
  "status": "connected",
  "position": {"x": 0, "y": 0, "z": 0},
  "gripper_status": "closed",
  "tracking_active": false
}
```

## ğŸ”Œ é›†æˆçœŸå®æœºæ¢°è‡‚

### 1. ç¡¬ä»¶è¿æ¥
è¦é›†æˆçœŸå®çš„æœºæ¢°è‡‚ç¡¬ä»¶ï¼Œéœ€è¦ï¼š

```python
# åœ¨ students/views.py ä¸­çš„ arm_control å‡½æ•°ä¸­æ·»åŠ ç¡¬ä»¶é€šä¿¡ä»£ç 

# ç¤ºä¾‹ï¼šä¸²å£é€šä¿¡
import serial

def connect_to_arm():
    try:
        arm_serial = serial.Serial('COM3', 9600, timeout=1)
        return arm_serial
    except Exception as e:
        print(f"è¿æ¥å¤±è´¥: {e}")
        return None

def send_movement_command(x, y, z):
    command = f"MOVE {x} {y} {z}\n"
    arm_serial.write(command.encode())
```

### 2. å…·ä½“é›†æˆæ­¥éª¤

#### æ­¥éª¤1ï¼šç¡®å®šé€šä¿¡åè®®
- æŸ¥çœ‹æœºæ¢°è‡‚çš„é€šä¿¡åè®®ï¼ˆä¸²å£ã€TCP/IPã€USBç­‰ï¼‰
- äº†è§£æœºæ¢°è‡‚çš„å‘½ä»¤æ ¼å¼å’Œåæ ‡ç³»

#### æ­¥éª¤2ï¼šåˆ›å»ºç¡¬ä»¶æ¥å£æ¨¡å—
```python
# åˆ›å»º students/arm_interface.py

class MechanicalArmInterface:
    def __init__(self):
        self.connected = False
        self.position = {'x': 0, 'y': 0, 'z': 0}

    def connect(self):
        # å®ç°å…·ä½“çš„ç¡¬ä»¶è¿æ¥é€»è¾‘
        pass

    def move_to(self, x, y, z):
        # å‘é€ç§»åŠ¨å‘½ä»¤åˆ°æœºæ¢°è‡‚
        pass

    def calibrate(self):
        # æ‰§è¡Œæ ¡å‡†ç¨‹åº
        pass

    def control_gripper(self, action):
        # æ§åˆ¶å¤¹çˆªï¼ˆopen/closeï¼‰
        pass
```

#### æ­¥éª¤3ï¼šä¿®æ”¹åç«¯è§†å›¾
```python
# åœ¨ students/views.py ä¸­
from .arm_interface import MechanicalArmInterface

# å…¨å±€æœºæ¢°è‡‚å®ä¾‹
arm_interface = MechanicalArmInterface()

@teacher_required
@require_http_methods(["POST"])
def arm_control(request):
    try:
        data = json.loads(request.body)
        command = data.get('command', '')
        position = data.get('position', {})

        if command == 'connect':
            result = arm_interface.connect()
        elif command == 'move':
            result = arm_interface.move_to(
                position.get('x', 0),
                position.get('y', 0),
                position.get('z', 0)
            )
        # ... å…¶ä»–å‘½ä»¤

        return JsonResponse({'status': 'success', 'result': result})
    except Exception as e:
        return JsonResponse({'status': 'error', 'message': str(e)})
```

### 3. åæ ‡ç³»æ˜ å°„
éœ€è¦å°†è§†é¢‘ä¸­çš„åƒç´ åæ ‡æ˜ å°„åˆ°æœºæ¢°è‡‚çš„ç‰©ç†åæ ‡ç³»ï¼š

```python
def map_video_to_arm_coordinates(video_x, video_y, video_width=640, video_height=480):
    # å°†è§†é¢‘åæ ‡è½¬æ¢ä¸ºæœºæ¢°è‡‚åæ ‡
    # éœ€è¦æ ¹æ®å®é™…çš„æœºæ¢°è‡‚å·¥ä½œèŒƒå›´è°ƒæ•´æ˜ å°„å‚æ•°

    # ç¤ºä¾‹æ˜ å°„
    arm_x_range = (-200, 200)  # æœºæ¢°è‡‚Xè½´èŒƒå›´ (mm)
    arm_y_range = (-150, 150)  # æœºæ¢°è‡‚Yè½´èŒƒå›´ (mm)

    # å½’ä¸€åŒ–è§†é¢‘åæ ‡åˆ°[-1, 1]
    norm_x = (video_x - video_width/2) / (video_width/2)
    norm_y = (video_y - video_height/2) / (video_height/2)

    # æ˜ å°„åˆ°æœºæ¢°è‡‚åæ ‡
    arm_x = norm_x * (arm_x_range[1] - arm_x_range[0]) / 2
    arm_y = norm_y * (arm_y_range[1] - arm_y_range[0]) / 2

    return arm_x, arm_y, 100  # Zè½´å›ºå®šè·ç¦»
```

## ğŸ“ ç›¸å…³æ–‡ä»¶ä½ç½®

### ä¸»è¦æ–‡ä»¶
- **æ¨¡æ¿æ–‡ä»¶**: `students/templates/students/robot_arm.html`
- **è§†å›¾æ–‡ä»¶**: `students/views.py` (robot_arm, arm_control, arm_status å‡½æ•°)
- **URLé…ç½®**: `students/urls.py`

### æ‰©å±•å»ºè®®
- **æœºæ¢°è‡‚æ¥å£**: `students/arm_interface.py` (æ–°å»º)
- **ç¡¬ä»¶é…ç½®**: `settings.py` (æ·»åŠ æœºæ¢°è‡‚é…ç½®é¡¹)

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **æ‘„åƒå¤´æ— æ³•è®¿é—®**
   - æ£€æŸ¥æµè§ˆå™¨æƒé™è®¾ç½®
   - ç¡®ä¿ä½¿ç”¨HTTPSæˆ–localhost

2. **äººè„¸æ£€æµ‹å¤±è´¥**
   - æ£€æŸ¥face-api.jsåº“æ˜¯å¦æ­£ç¡®åŠ è½½
   - ç¡®ä¿å…‰çº¿å……è¶³ï¼Œäººè„¸æ¸…æ™°å¯è§

3. **æœºæ¢°è‡‚è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ç¡¬ä»¶è¿æ¥å’Œç«¯å£é…ç½®
   - ç¡®è®¤æœºæ¢°è‡‚é©±åŠ¨ç¨‹åºæ­£å¸¸å®‰è£…

### è°ƒè¯•æŠ€å·§
- æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—
- æ£€æŸ¥ç½‘ç»œè¯·æ±‚æ˜¯å¦æ­£å¸¸å‘é€
- éªŒè¯APIå“åº”æ•°æ®æ ¼å¼

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æƒé™æ§åˆ¶**ï¼šç³»ç»Ÿéœ€è¦æ•™å¸ˆæƒé™æ‰èƒ½è®¿é—®
2. **æµè§ˆå™¨å…¼å®¹æ€§**ï¼šæ¨èä½¿ç”¨Chromeæˆ–Firefoxæµè§ˆå™¨
3. **ç½‘ç»œç¯å¢ƒ**ï¼šface-api.jséœ€è¦ä¸‹è½½æ¨¡å‹æ–‡ä»¶ï¼Œç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸
4. **ç¡¬ä»¶å®‰å…¨**ï¼šé›†æˆçœŸå®æœºæ¢°è‡‚æ—¶æ³¨æ„å®‰å…¨é˜²æŠ¤æªæ–½

## ğŸ¯ ä¸‹ä¸€æ­¥å¼€å‘å»ºè®®

1. **å¤šç›®æ ‡è¿½è¸ª**ï¼šæ”¯æŒåŒæ—¶è¿½è¸ªå¤šä¸ªäººè„¸
2. **æ‰‹åŠ¿è¯†åˆ«**ï¼šå¢åŠ æ‰‹åŠ¿æ§åˆ¶æœºæ¢°è‡‚åŠŸèƒ½
3. **è¯­éŸ³æ§åˆ¶**ï¼šé›†æˆè¯­éŸ³è¯†åˆ«è¿›è¡Œæœºæ¢°è‡‚æ§åˆ¶
4. **æ•°æ®è®°å½•**ï¼šè®°å½•è¿½è¸ªæ•°æ®ç”¨äºæ•™å­¦åˆ†æ
5. **é¢„è®¾åŠ¨ä½œ**ï¼šæ·»åŠ é¢„è®¾çš„æœºæ¢°è‡‚åŠ¨ä½œåºåˆ—

---

**ç³»ç»Ÿå·²æˆåŠŸé›†æˆäººè„¸è¿½è¸ªåŠŸèƒ½ï¼** ğŸ‰

ç°åœ¨å¯ä»¥é€šè¿‡è®¿é—® `http://localhost:8000/robot-arm/` æ¥ä½“éªŒå®Œæ•´çš„åŠŸèƒ½ã€‚